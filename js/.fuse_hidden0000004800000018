// Helper function to hide loading states and show content
function hideLoadingStates() {
    document.querySelectorAll('.loading-container').forEach(container => {
        container.style.display = 'none';
    });
    document.querySelectorAll('.recent-items').forEach(el => {
        el.classList.remove('hidden');
    });
}

// Update dashboard
function updateDashboard() {
    // Update stats
    totalProjectsEl.textContent = projects.length;

    // Categorize projects by status - USE EXACT STRING MATCHING
    const ongoingProjects = projects.filter(p => p.status === 'Ongoing');
    const upcomingProjects = projects.filter(p => p.status === 'Upcoming');
    const finishedProjects = projects.filter(p => p.status === 'Finished');

    console.log('Projects categorized:', { 
        ongoing: ongoingProjects.length, 
        upcoming: upcomingProjects.length, 
        finished: finishedProjects.length 
    });

    // Update ongoing projects
    const ongoingProjectsEl = document.getElementById('ongoing-projects');
    if (ongoingProjects.length === 0) {
        ongoingProjectsEl.innerHTML = `
            <div class="recent-item">
                <div class="recent-icon">
                    <i class="fas fa-construction"></i>
                </div>
                <div class="recent-info">
                    <h4>No ongoing projects yet</h4>
                    <p>Add your first ongoing project</p>
                </div>
            </div>
        `;
    } else {
        ongoingProjectsEl.innerHTML = '';
        const recentProjects = ongoingProjects.slice(-3).reverse();
        recentProjects.forEach(project => {
            const projectEl = document.createElement('div');
            projectEl.className = 'recent-item';
            projectEl.innerHTML = `
                <div class="recent-icon">
                    <i class="fas fa-construction"></i>
                </div>
                <div class="recent-info">
                    <h4>${project.name}</h4>
                    <p>${project.location}</p>
                </div>
            `;
            // projectEl.onclick = () => editProperty(project.id); // Removed edit functionality
            ongoingProjectsEl.appendChild(projectEl);
        });
    }

    // Update upcoming projects
    const upcomingProjectsEl = document.getElementById('upcoming-projects');
    if (upcomingProjects.length === 0) {
        upcomingProjectsEl.innerHTML = `
            <div class="recent-item">
                <div class="recent-icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <div class="recent-info">
                    <h4>No upcoming projects yet</h4>
                    <p>Add your first upcoming project</p>
                </div>
            </div>
        `;
    } else {
        upcomingProjectsEl.innerHTML = '';
        const recentProjects = upcomingProjects.slice(-3).reverse();
        recentProjects.forEach(project => {
            const projectEl = document.createElement('div');
            projectEl.className = 'recent-item';
            projectEl.innerHTML = `
                <div class="recent-icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <div class="recent-info">
                    <h4>${project.name}</h4>
                    <p>${project.location}</p>
                </div>
            `;
            // projectEl.onclick = () => editProperty(project.id); // Removed edit functionality
            upcomingProjectsEl.appendChild(projectEl);
        });
    }

    // Update finished projects
    const finishedProjectsEl = document.getElementById('finished-projects');
    if (finishedProjects.length === 0) {
        finishedProjectsEl.innerHTML = `
            <div class="recent-item">
                <div class="recent-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="recent-info">
                    <h4>No finished projects yet</h4>
                    <p>Add your first finished project</p>
                </div>
            </div>
        `;
    } else {
        finishedProjectsEl.innerHTML = '';
        const recentProjects = finishedProjects.slice(-3).reverse();
        recentProjects.forEach(project => {
            const projectEl = document.createElement('div');
            projectEl.className = 'recent-item';
            projectEl.innerHTML = `
                <div class="recent-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="recent-info">
                    <h4>${project.name}</h4>
                    <p>${project.location}</p>
                </div>
            `;
            // projectEl.onclick = () => editProperty(project.id); // Removed edit functionality
            finishedProjectsEl.appendChild(projectEl);
        });
    }
}